
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/plot_b_aperture.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_plot_b_aperture.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_plot_b_aperture.py:


===================
Aperture Photometry
===================
Measuring PSF Photometry with space_phot.

.. GENERATED FROM PYTHON SOURCE LINES 9-12

An example HST Dataset is downloaded, and then we measure 
aperture photometry. This is public HST data for the
gravitationally lensed SN 2022riv

.. GENERATED FROM PYTHON SOURCE LINES 12-30

.. code-block:: default

   

    import sys,os,glob
    from astropy.io import fits
    from astropy.table import Table
    from astropy.nddata import extract_array
    from astropy.coordinates import SkyCoord
    from astropy import wcs
    from astropy.wcs.utils import skycoord_to_pixel
    from astropy import units as u
    import numpy as np
    import matplotlib.pyplot as plt
    from astroquery.mast import Observations
    from astropy.visualization import (simple_norm,LinearStretch)

    import space_phot









.. GENERATED FROM PYTHON SOURCE LINES 31-38

----------
HST Images
----------

**Download some Data**

For this example we download HST FLT images from MAST.  

.. GENERATED FROM PYTHON SOURCE LINES 39-49

.. code-block:: default


    obs_table = Observations.query_criteria(obs_id='hst_16264_12_wfc3_ir_f110w_iebc12')
    obs_table1 = obs_table[obs_table['filters']=='F110W']

    data_products_by_obs = Observations.get_product_list(obs_table1)
    data_products_by_obs = data_products_by_obs[data_products_by_obs['calib_level']==2]
    data_products_by_obs = data_products_by_obs[data_products_by_obs['productSubGroupDescription']=='FLT'][:3]
    Observations.download_products(data_products_by_obs,extension='fits')






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    INFO: Found cached file ./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q3/hst_16264_12_wfc3_ir_f110w_iebc12q3_flt.fits with expected size 16580160. [astroquery.query]
    INFO: Found cached file ./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q5/hst_16264_12_wfc3_ir_f110w_iebc12q5_flt.fits with expected size 16580160. [astroquery.query]
    INFO: Found cached file ./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q7/hst_16264_12_wfc3_ir_f110w_iebc12q7_flt.fits with expected size 16580160. [astroquery.query]


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><i>Table length=3</i>
    <table id="table140695633464048" class="table-striped table-bordered table-condensed">
    <thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
    <thead><tr><th>str99</th><th>str8</th><th>object</th><th>object</th></tr></thead>
    <tr><td>./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q3/hst_16264_12_wfc3_ir_f110w_iebc12q3_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    <tr><td>./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q5/hst_16264_12_wfc3_ir_f110w_iebc12q5_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    <tr><td>./mastDownload/HST/hst_16264_12_wfc3_ir_f110w_iebc12q7/hst_16264_12_wfc3_ir_f110w_iebc12q7_flt.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    </table></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 50-52

**Examine the first Image**


.. GENERATED FROM PYTHON SOURCE LINES 52-64

.. code-block:: default


    files = glob.glob('mastDownload/HST/*/*flt.fits')
    ref_image = files[0]
    ref_fits = fits.open(ref_image)
    ref_data = fits.open(ref_image)['SCI',1].data
    norm1 = simple_norm(ref_data,stretch='linear',min_cut=-1,max_cut=10)

    plt.imshow(ref_data, origin='lower',
                          norm=norm1,cmap='gray')
    plt.gca().tick_params(labelcolor='none',axis='both',color='none')
    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_b_aperture_001.png
   :alt: plot b aperture
   :srcset: /examples/images/sphx_glr_plot_b_aperture_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 65-67

**Zoom in to see the Supernova**


.. GENERATED FROM PYTHON SOURCE LINES 67-78

.. code-block:: default


    sn_location = SkyCoord('21:29:40.2110','+0:05:24.154',unit=(u.hourangle,u.deg))
    ref_y,ref_x = skycoord_to_pixel(sn_location,wcs.WCS(ref_fits['SCI',1],ref_fits))
    ref_cutout = extract_array(ref_data,(11,11),(ref_x,ref_y))
    norm1 = simple_norm(ref_cutout,stretch='linear',min_cut=-1,max_cut=10)
    plt.imshow(ref_cutout, origin='lower',
                          norm=norm1,cmap='gray')
    plt.title('SN2022riv')
    plt.gca().tick_params(labelcolor='none',axis='both',color='none')
    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_b_aperture_002.png
   :alt: SN2022riv
   :srcset: /examples/images/sphx_glr_plot_b_aperture_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 79-81

**Measure the aperture photometry**


.. GENERATED FROM PYTHON SOURCE LINES 81-87

.. code-block:: default

    hst_obs = space_phot.observation2(files)
    hst_obs.aperture_photometry(sn_location,radius=3,
                        skyan_in=5,skyan_out=7)
    print(hst_obs.aperture_result.phot_cal_table)






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /Users/jpierel/CodeBase/space_phot/space_phot/cal.py:67: RuntimeWarning: invalid value encountered in log10
      mag = -2.5*np.log10(flux)+zp
          flux_cal      ...                     exp                     
    ------------------- ... --------------------------------------------
    -1.0557272803762083 ... hst_16264_12_wfc3_ir_f110w_iebc12q3_flt.fits
      6.243869285388999 ... hst_16264_12_wfc3_ir_f110w_iebc12q5_flt.fits
      6.582615177216627 ... hst_16264_12_wfc3_ir_f110w_iebc12q7_flt.fits




.. GENERATED FROM PYTHON SOURCE LINES 88-97

-----------
JWST Images
-----------

**Download some Data**

For this example we download JWST cal images from MAST. We just use
4 of the 8 dithered exposures  for speed here, but in principle
space_phot can handle as many as are needed (given time).

.. GENERATED FROM PYTHON SOURCE LINES 98-111

.. code-block:: default

    obs_table = Observations.query_criteria(obs_id='jw02767-o002_t001_nircam_clear-f150w')
    data_products_by_obs = Observations.get_product_list(obs_table)
    data_products_by_obs = data_products_by_obs[data_products_by_obs['calib_level']==2]
    data_products_by_obs = data_products_by_obs[data_products_by_obs['productSubGroupDescription']=='CAL']

    # Just take the nrcb3 cals (where the SN is located)
    to_remove = []
    for i in range(len(data_products_by_obs)):
        if not data_products_by_obs[i]['obs_id'].endswith('nrcb3'):
            to_remove.append(i)
    data_products_by_obs.remove_rows(to_remove)
    Observations.download_products(data_products_by_obs[:4],extension='fits')





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    INFO: Found cached file ./mastDownload/JWST/jw02767002001_02103_00001_nrcb3/jw02767002001_02103_00001_nrcb3_cal.fits with expected size 117538560. [astroquery.query]
    INFO: Found cached file ./mastDownload/JWST/jw02767002001_02103_00002_nrcb3/jw02767002001_02103_00002_nrcb3_cal.fits with expected size 117538560. [astroquery.query]
    INFO: Found cached file ./mastDownload/JWST/jw02767002001_02103_00003_nrcb3/jw02767002001_02103_00003_nrcb3_cal.fits with expected size 117538560. [astroquery.query]
    INFO: Found cached file ./mastDownload/JWST/jw02767002001_02103_00004_nrcb3/jw02767002001_02103_00004_nrcb3_cal.fits with expected size 117538560. [astroquery.query]


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div><i>Table length=4</i>
    <table id="table140695633470576" class="table-striped table-bordered table-condensed">
    <thead><tr><th>Local Path</th><th>Status</th><th>Message</th><th>URL</th></tr></thead>
    <thead><tr><th>str92</th><th>str8</th><th>object</th><th>object</th></tr></thead>
    <tr><td>./mastDownload/JWST/jw02767002001_02103_00001_nrcb3/jw02767002001_02103_00001_nrcb3_cal.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    <tr><td>./mastDownload/JWST/jw02767002001_02103_00002_nrcb3/jw02767002001_02103_00002_nrcb3_cal.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    <tr><td>./mastDownload/JWST/jw02767002001_02103_00003_nrcb3/jw02767002001_02103_00003_nrcb3_cal.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    <tr><td>./mastDownload/JWST/jw02767002001_02103_00004_nrcb3/jw02767002001_02103_00004_nrcb3_cal.fits</td><td>COMPLETE</td><td>None</td><td>None</td></tr>
    </table></div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 112-114

**Examine the first Image**


.. GENERATED FROM PYTHON SOURCE LINES 114-126

.. code-block:: default


    files = glob.glob('mastDownload/JWST/*/*cal.fits')
    ref_image = files[0]
    ref_fits = fits.open(ref_image)
    ref_data = fits.open(ref_image)['SCI',1].data
    norm1 = simple_norm(ref_data,stretch='linear',min_cut=-1,max_cut=10)

    plt.imshow(ref_data, origin='lower',
                          norm=norm1,cmap='gray')
    plt.gca().tick_params(labelcolor='none',axis='both',color='none')
    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_b_aperture_003.png
   :alt: plot b aperture
   :srcset: /examples/images/sphx_glr_plot_b_aperture_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 127-129

**Zoom in to see the Supernova**


.. GENERATED FROM PYTHON SOURCE LINES 129-140

.. code-block:: default


    sn_location = SkyCoord('21:29:40.2103','+0:05:24.158',unit=(u.hourangle,u.deg))
    ref_y,ref_x = skycoord_to_pixel(sn_location,wcs.WCS(ref_fits['SCI',1],ref_fits))
    ref_cutout = extract_array(ref_data,(11,11),(ref_x,ref_y))
    norm1 = simple_norm(ref_cutout,stretch='linear',min_cut=-1,max_cut=10)
    plt.imshow(ref_cutout, origin='lower',
                          norm=norm1,cmap='gray')
    plt.title('SN2022riv')
    plt.gca().tick_params(labelcolor='none',axis='both',color='none')
    plt.show()




.. image-sg:: /examples/images/sphx_glr_plot_b_aperture_004.png
   :alt: SN2022riv
   :srcset: /examples/images/sphx_glr_plot_b_aperture_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'datfix' made the change 'Set DATE-BEG to '2022-10-06T10:18:17.568' from MJD-BEG.
    Set DATE-AVG to '2022-10-06T10:23:39.671' from MJD-AVG.
    Set DATE-END to '2022-10-06T10:29:01.774' from MJD-END'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'obsfix' made the change 'Set OBSGEO-L to     4.936334 from OBSGEO-[XYZ].
    Set OBSGEO-B to    20.544618 from OBSGEO-[XYZ].
    Set OBSGEO-H to 1233352579.016 from OBSGEO-[XYZ]'.
      warnings.warn(




.. GENERATED FROM PYTHON SOURCE LINES 141-143

**Measure the aperture photometry**


.. GENERATED FROM PYTHON SOURCE LINES 143-148

.. code-block:: default

    jwst_obs = space_phot.observation2(files)
    jwst_obs.aperture_photometry(sn_location,encircled_energy='70')
    print(jwst_obs.aperture_result.phot_cal_table)






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'datfix' made the change 'Set DATE-BEG to '2022-10-06T10:18:17.568' from MJD-BEG.
    Set DATE-AVG to '2022-10-06T10:23:39.671' from MJD-AVG.
    Set DATE-END to '2022-10-06T10:29:01.774' from MJD-END'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'obsfix' made the change 'Set OBSGEO-L to     4.936334 from OBSGEO-[XYZ].
    Set OBSGEO-B to    20.544618 from OBSGEO-[XYZ].
    Set OBSGEO-H to 1233352579.016 from OBSGEO-[XYZ]'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'datfix' made the change 'Set DATE-BEG to '2022-10-06T10:41:33.343' from MJD-BEG.
    Set DATE-AVG to '2022-10-06T10:46:55.446' from MJD-AVG.
    Set DATE-END to '2022-10-06T10:52:17.549' from MJD-END'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'obsfix' made the change 'Set OBSGEO-L to     4.973145 from OBSGEO-[XYZ].
    Set OBSGEO-B to    20.561198 from OBSGEO-[XYZ].
    Set OBSGEO-H to 1233361578.113 from OBSGEO-[XYZ]'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'datfix' made the change 'Set DATE-BEG to '2022-10-06T10:29:33.983' from MJD-BEG.
    Set DATE-AVG to '2022-10-06T10:34:56.086' from MJD-AVG.
    Set DATE-END to '2022-10-06T10:40:18.189' from MJD-END'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'obsfix' made the change 'Set OBSGEO-L to     4.954699 from OBSGEO-[XYZ].
    Set OBSGEO-B to    20.552882 from OBSGEO-[XYZ].
    Set OBSGEO-H to 1233357096.537 from OBSGEO-[XYZ]'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'datfix' made the change 'Set DATE-BEG to '2022-10-06T10:52:49.758' from MJD-BEG.
    Set DATE-AVG to '2022-10-06T10:58:11.861' from MJD-AVG.
    Set DATE-END to '2022-10-06T11:03:33.964' from MJD-END'.
      warnings.warn(
    /Users/jpierel/miniconda3/envs/tweakreg/lib/python3.10/site-packages/astropy/wcs/wcs.py:803: FITSFixedWarning: 'obsfix' made the change 'Set OBSGEO-L to     4.990493 from OBSGEO-[XYZ].
    Set OBSGEO-B to    20.569016 from OBSGEO-[XYZ].
    Set OBSGEO-H to 1233365823.364 from OBSGEO-[XYZ]'.
      warnings.warn(
           flux_cal       ...                   exp                   
    --------------------- ... ----------------------------------------
    7.018505806740728e-13 ... jw02767002001_02103_00001_nrcb3_cal.fits
    7.021870407673275e-13 ... jw02767002001_02103_00003_nrcb3_cal.fits
    7.112805309643311e-13 ... jw02767002001_02103_00002_nrcb3_cal.fits
    6.965374111490209e-13 ... jw02767002001_02103_00004_nrcb3_cal.fits





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  8.393 seconds)


.. _sphx_glr_download_examples_plot_b_aperture.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_b_aperture.py <plot_b_aperture.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_b_aperture.ipynb <plot_b_aperture.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
